!function(e){function s(r){if(t[r])return t[r].exports;var n=t[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}var t={};return s.m=e,s.c=t,s.p="",s(0)}([function(e,s,t){"use strict";e.exports=t(1)},function(e,s){"use strict";function t(e,s){this._handleMessage=this._handleMessage.bind(this),this._handlers=new Map,this._pendingMessages=new Map,this._messageID=0,this._doDebug=!1,this.port=e,this.port.addEventListener("message",this._handleMessage),this.port.start(),this.origin=s}var r="X-StructuredChannel-internal-reply",n="X-StructuredChannel-internal-hello",i="*";t.prototype={_debug:function(){if(this._doDebug){for(var e=arguments.length,s=Array(e),t=0;e>t;t++)s[t]=arguments[t];console.log.apply(console,["DEBUG:"].concat(s))}},_warn:function(){for(var e=arguments.length,s=Array(e),t=0;e>t;t++)s[t]=arguments[t];console.warn.apply(console,["WARNING:"].concat(s))},on:function(e,s){if(this._handlers.has(e))throw new Error("Multiple handlers registered for "+e);this._handlers.set(e,s)},off:function(e){return this._handlers.has(e)?void this._handlers["delete"](e):void this._warn("WARNING: Tried to unregister handler for",e,"that has no handler.")},send:function(e,s){var t=this,r={id:this._messageID++,payload:s,type:e};return new Promise(function(e,s){t._pendingMessages.set(r.id,{resolve:e,reject:s}),t.port.postMessage(r)})},_handleMessage:function(e){var s=this;if(this.origin!==i&&this.origin!==e.origin)return void this._warn("Got a message from unexpected origin",e.origin);var t=e.data.data;this._debug("Got a message with data:",t);var n=t.id,a=t.type,o=t.payload;if(!n||!a||"string"!=typeof a||!a.trim())return void this._warn("Got an invalid message:",t);if(a===r){if(!this._pendingMessages.has(n))return void this._debug("Ignoring an unexpected reply.");var d=this._pendingMessages.get(n),h=d.resolve,g=d.reject;return t.error?(this._debug("Received an error reply for message",n),this._debug("Error was",t.error),g(t.error)):(this._debug("Received a success reply for message",n),this._debug("Result was",t.result),h(t.result)),void this._pendingMessages["delete"](n)}var l=this._handlers.get(a),u=null;try{l?u=Promise.resolve(l(o)):(this._warn("Received a message of type",a,"that has no handler."),u=Promise.reject("Unhandled message "+a))}catch(p){this._warn("Handler function failed:",p),u=Promise.reject(p)}u.then(function(e){s.port.postMessage({type:r,error:!1,result:e,id:n})},function(e){s.port.postMessage({type:r,error:e,id:n})})}},t.connectTo=function(e,s,r){"function"==typeof s.MessageChannel&&(r=s,s=void 0);var a=r?new r.MessageChannel:new MessageChannel;if(e instanceof Window){var o=s?s:i;e.postMessage(n,o,[a.port2])}else e.postMessage(n,[a.port2]);return new t(a.port1,origin)},t.waitForConnection=function(e,s){return new Promise(function(e,r){var i=function(r){r.data===n&&(s.onmessage=null,e(new t(r.ports[0])))};s.onmessage=i})},e.exports=t}]);